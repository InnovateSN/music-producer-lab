<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Lesson 13 · Humanization & Groove Templates | Music Producer Lab</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="description" content="Make programmed drums feel human. Learn timing shifts, velocity curves, and groove template application." />
    <link rel="stylesheet" href="styles.css">
    <style>
      /* Humanization Visualizer */
      .humanize-demo {
        background: linear-gradient(135deg, #2d3436, #636e72);
        border-radius: var(--radius-lg);
        padding: var(--space-xl);
        margin: var(--space-xl) 0;
      }

      .timing-grid {
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
      }

      .timing-row {
        display: flex;
        align-items: center;
        gap: var(--space-md);
      }

      .timing-row .label {
        width: 80px;
        font-weight: 600;
        font-size: 0.85rem;
      }

      .beat-grid {
        flex: 1;
        display: flex;
        gap: 4px;
        background: var(--bg-tertiary);
        padding: var(--space-sm);
        border-radius: var(--radius-sm);
        position: relative;
      }

      .beat-grid::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        background: var(--border-subtle);
      }

      .beat-marker {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--accent-coral);
        position: relative;
        transition: transform 0.2s;
      }

      .beat-marker.offset-early {
        transform: translateX(-3px);
        background: var(--accent-cyan);
      }

      .beat-marker.offset-late {
        transform: translateX(3px);
        background: var(--accent-amber);
      }

      /* Velocity Curve */
      .velocity-curve {
        background: var(--bg-secondary);
        border-radius: var(--radius-lg);
        padding: var(--space-lg);
        margin: var(--space-xl) 0;
      }

      .velocity-bars {
        display: flex;
        align-items: flex-end;
        justify-content: space-around;
        height: 150px;
        gap: 4px;
        padding: var(--space-md);
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
      }

      .velocity-bar {
        width: 20px;
        background: linear-gradient(to top, var(--accent-coral), var(--accent-amber));
        border-radius: 4px 4px 0 0;
        transition: height 0.3s;
      }

      /* Groove Templates */
      .groove-templates {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: var(--space-lg);
        margin: var(--space-xl) 0;
      }

      .groove-card {
        background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
        border: 2px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: var(--space-lg);
        cursor: pointer;
        transition: all 0.2s;
      }

      .groove-card:hover {
        border-color: var(--accent-cyan);
        transform: translateY(-2px);
      }

      .groove-card.active {
        border-color: var(--accent-coral);
        box-shadow: 0 0 20px rgba(231, 112, 85, 0.2);
      }

      .groove-card h3 {
        font-size: 1.1rem;
        margin-bottom: var(--space-xs);
        display: flex;
        align-items: center;
        gap: var(--space-sm);
      }

      .groove-card .swing-value {
        font-family: monospace;
        font-size: 0.75rem;
        background: var(--accent-cyan);
        color: #000;
        padding: 2px 8px;
        border-radius: var(--radius-sm);
      }

      .groove-card p {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: var(--space-md);
      }

      .groove-visual {
        height: 40px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: space-around;
        padding: 0 var(--space-sm);
      }

      .groove-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--accent-coral);
      }

      /* Humanization Controls */
      .humanize-controls {
        background: var(--bg-secondary);
        border-radius: var(--radius-lg);
        padding: var(--space-lg);
        margin: var(--space-xl) 0;
      }

      .control-group {
        margin-bottom: var(--space-lg);
      }

      .control-group:last-child {
        margin-bottom: 0;
      }

      .control-group label {
        display: block;
        font-weight: 600;
        margin-bottom: var(--space-sm);
      }

      .slider-container {
        display: flex;
        align-items: center;
        gap: var(--space-md);
      }

      .slider-container input[type="range"] {
        flex: 1;
        height: 6px;
        border-radius: 3px;
        background: var(--bg-tertiary);
        cursor: pointer;
      }

      .slider-value {
        font-family: monospace;
        font-size: 0.85rem;
        min-width: 40px;
        text-align: right;
      }

      /* Comparison Panel */
      .comparison-panel {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-lg);
        margin: var(--space-xl) 0;
      }

      .comparison-side {
        background: var(--bg-secondary);
        border-radius: var(--radius-lg);
        padding: var(--space-lg);
      }

      .comparison-side h3 {
        font-size: 1rem;
        margin-bottom: var(--space-md);
        display: flex;
        align-items: center;
        gap: var(--space-sm);
      }

      .comparison-side.robotic h3 {
        color: var(--accent-coral);
      }

      .comparison-side.humanized h3 {
        color: var(--accent-cyan);
      }

      .check-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .check-list li {
        padding: var(--space-xs) 0;
      }

      .check-list li::before {
        content: "✓ ";
        color: var(--accent-cyan);
        font-weight: bold;
        margin-right: var(--space-xs);
      }

      .tip-box {
        background: var(--bg-secondary);
        border-left: 4px solid var(--accent-cyan);
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        margin-top: var(--space-lg);
      }

      @media (max-width: 768px) {
        .comparison-panel {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <div class="page-inner">
        <header class="mpl-nav">
          <div class="mpl-nav-logo">
            <img src="mpl-logo-full.svg" alt="Music Producer Lab" class="mpl-nav-logo-img" />
          </div>
          <div class="mpl-nav-actions">
            <button class="btn btn-outline" type="button" onclick="window.location.href='labs.html'">
              <span>Back to overview</span>
            </button>
          </div>
        </header>

        <section class="hero" aria-label="Lesson 13 · Humanization">
          <div class="hero-copy">
            <div class="hero-copy-eyebrow">Lesson 13 · Drum pattern</div>
            <h1 class="hero-title">Humanization & <span>Groove Templates</span></h1>
            <p class="hero-subtitle">
              Make programmed drums <strong>feel human</strong>. Master <strong>micro-timing shifts</strong>,
              <strong>velocity curves</strong>, and <strong>groove template extraction</strong> for
              professional-sounding rhythms.
            </p>
            <div style="margin-top:1rem;">
              <a class="btn btn-primary" href="lesson-drums-12.html"><span>← Lesson 12</span></a>
              <a class="btn btn-primary" href="lesson-drums-14.html" style="margin-left:0.6rem;"><span>Lesson 14 →</span></a>
            </div>
          </div>

          <aside class="hero-visual" aria-hidden="true">
            <div class="hero-visual-header">
              <div class="hero-visual-title">Advanced Technique</div>
              <div class="hero-visual-pill">Humanization</div>
            </div>
            <div class="hero-visual-grid">
              <div class="hero-visual-main">
                <div class="hero-visual-main-title">Feel & Groove</div>
                <div class="hero-visual-waves">
                  <div class="hero-visual-wave"></div>
                  <div class="hero-visual-wave"></div>
                  <div class="hero-visual-wave"></div>
                  <div class="hero-visual-wave"></div>
                  <div class="hero-visual-wave"></div>
                </div>
                <div class="hero-visual-metrics">
                  <div class="hero-visual-metric">
                    <span>Focus</span>
                    <strong>Timing & Velocity</strong>
                  </div>
                  <div class="hero-visual-metric">
                    <span>Time</span>
                    <strong>20–25 min</strong>
                  </div>
                </div>
              </div>
              <div class="hero-visual-side-card">
                <div class="hero-visual-side-label">Goal</div>
                <div class="hero-visual-pill-list">
                  <div class="hero-visual-pill-tag">Micro-timing shifts</div>
                  <div class="hero-visual-pill-tag">Natural velocity curves</div>
                </div>
                <div class="hero-visual-footer">
                  <span>Make it feel alive</span>
                  <span>Professional polish</span>
                </div>
              </div>
            </div>
          </aside>
        </section>

        <section class="sections-grid" aria-label="Lesson 13 concepts">
          <article class="section">
            <div class="section-eyebrow">Problem</div>
            <h2 class="section-title">The Problem with Perfect Timing</h2>
            <p class="section-body">
              Perfectly quantized drums sound <strong>mechanical and lifeless</strong>. Real drummers
              never hit exactly on the beat—they push and pull timing, vary velocity, and create
              <strong>organic feel</strong>.
            </p>

            <div class="comparison-panel">
              <div class="comparison-side robotic">
                <h3>Robotic (Quantized)</h3>
                <ul class="check-list">
                  <li>Every hit exactly on grid</li>
                  <li>Identical velocity levels</li>
                  <li>No variation between bars</li>
                  <li>Sounds "fake" and sterile</li>
                </ul>
              </div>
              <div class="comparison-side humanized">
                <h3>Humanized</h3>
                <ul class="check-list">
                  <li>Slight timing variations (±10ms)</li>
                  <li>Natural velocity curves</li>
                  <li>Subtle pattern changes</li>
                  <li>Sounds organic and alive</li>
                </ul>
              </div>
            </div>
          </article>

          <article class="section">
            <div class="section-eyebrow">Timing</div>
            <h2 class="section-title">Micro-Timing Shifts</h2>
            <p class="section-body">
              Small timing variations of <strong>5-20 milliseconds</strong> create a human feel without
              sounding sloppy. Different instruments push or pull slightly against the beat.
            </p>

            <div class="humanize-demo">
              <div class="timing-grid">
                <div class="timing-row">
                  <span class="label">Kick</span>
                  <div class="beat-grid" id="kickTiming">
                    <div class="beat-marker"></div>
                    <div class="beat-marker offset-late"></div>
                    <div class="beat-marker"></div>
                    <div class="beat-marker offset-early"></div>
                  </div>
                </div>
                <div class="timing-row">
                  <span class="label">Snare</span>
                  <div class="beat-grid" id="snareTiming">
                    <div class="beat-marker offset-late"></div>
                    <div class="beat-marker"></div>
                    <div class="beat-marker offset-late"></div>
                    <div class="beat-marker"></div>
                  </div>
                </div>
                <div class="timing-row">
                  <span class="label">Hi-Hat</span>
                  <div class="beat-grid" id="hihatTiming">
                    <div class="beat-marker offset-early"></div>
                    <div class="beat-marker offset-early"></div>
                    <div class="beat-marker"></div>
                    <div class="beat-marker offset-early"></div>
                  </div>
                </div>
              </div>

              <div style="margin-top: var(--space-lg); display: flex; gap: var(--space-md); flex-wrap: wrap;">
                <span style="display: flex; align-items: center; gap: var(--space-xs); font-size: 0.8rem;">
                  <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--accent-cyan);"></div>
                  Early (push)
                </span>
                <span style="display: flex; align-items: center; gap: var(--space-xs); font-size: 0.8rem;">
                  <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--accent-coral);"></div>
                  On Grid
                </span>
                <span style="display: flex; align-items: center; gap: var(--space-xs); font-size: 0.8rem;">
                  <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--accent-amber);"></div>
                  Late (lay back)
                </span>
              </div>
            </div>

            <div class="tip-box">
              <strong>Pro Tip:</strong> Hi-hats often push slightly ahead for drive, while snares can lay back for a relaxed feel. Kicks usually anchor close to the grid.
            </div>
          </article>

          <article class="section">
            <div class="section-eyebrow">Dynamics</div>
            <h2 class="section-title">Velocity Curves</h2>
            <p class="section-body">
              Real drummers don't hit every note at the same volume. <strong>Downbeats are louder</strong>,
              ghost notes are soft, and accents create emphasis.
            </p>

            <div class="velocity-curve">
              <h3 style="margin-bottom: var(--space-md);">Hi-Hat Velocity Pattern (16 steps)</h3>
              <div class="velocity-bars" id="velocityDemo">
                <div class="velocity-bar" style="height: 100%;"></div>
                <div class="velocity-bar" style="height: 40%;"></div>
                <div class="velocity-bar" style="height: 70%;"></div>
                <div class="velocity-bar" style="height: 45%;"></div>
                <div class="velocity-bar" style="height: 90%;"></div>
                <div class="velocity-bar" style="height: 35%;"></div>
                <div class="velocity-bar" style="height: 65%;"></div>
                <div class="velocity-bar" style="height: 40%;"></div>
                <div class="velocity-bar" style="height: 100%;"></div>
                <div class="velocity-bar" style="height: 38%;"></div>
                <div class="velocity-bar" style="height: 68%;"></div>
                <div class="velocity-bar" style="height: 42%;"></div>
                <div class="velocity-bar" style="height: 88%;"></div>
                <div class="velocity-bar" style="height: 36%;"></div>
                <div class="velocity-bar" style="height: 62%;"></div>
                <div class="velocity-bar" style="height: 44%;"></div>
              </div>

              <div style="margin-top: var(--space-md); display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted);">
                <span>Beat 1</span>
                <span>Beat 2</span>
                <span>Beat 3</span>
                <span>Beat 4</span>
              </div>
            </div>

            <p style="font-size: 0.9rem; color: var(--text-muted);">
              Notice how <strong>downbeats (1, 2, 3, 4)</strong> are louder, while the <strong>off-beats</strong>
              are softer. This creates a natural "breathing" groove.
            </p>
          </article>

          <article class="section">
            <div class="section-eyebrow">Templates</div>
            <h2 class="section-title">Groove Templates</h2>
            <p class="section-body">
              Groove templates capture the <strong>timing and velocity feel</strong> of a recorded performance.
              You can extract grooves from classic songs and apply them to your programmed drums.
            </p>

            <div class="groove-templates">
              <div class="groove-card active" data-groove="mpc60">
                <h3>MPC 60 Swing <span class="swing-value">54%</span></h3>
                <p>Classic hip-hop swing from the Akai MPC. Delays 16th notes slightly for that boom bap feel.</p>
                <div class="groove-visual">
                  <div class="groove-dot"></div>
                  <div class="groove-dot" style="margin-left: 8px;"></div>
                  <div class="groove-dot"></div>
                  <div class="groove-dot" style="margin-left: 8px;"></div>
                </div>
              </div>

              <div class="groove-card" data-groove="tr808">
                <h3>TR-808 Feel <span class="swing-value">50%</span></h3>
                <p>Straight quantize with subtle velocity variation. Clean and punchy for electronic genres.</p>
                <div class="groove-visual">
                  <div class="groove-dot"></div>
                  <div class="groove-dot"></div>
                  <div class="groove-dot"></div>
                  <div class="groove-dot"></div>
                </div>
              </div>

              <div class="groove-card" data-groove="motown">
                <h3>Motown Pocket <span class="swing-value">58%</span></h3>
                <p>Laid-back soul feel with heavy swing. Snare sits behind the beat for a relaxed groove.</p>
                <div class="groove-visual">
                  <div class="groove-dot"></div>
                  <div class="groove-dot" style="margin-left: 12px;"></div>
                  <div class="groove-dot"></div>
                  <div class="groove-dot" style="margin-left: 12px;"></div>
                </div>
              </div>

              <div class="groove-card" data-groove="live">
                <h3>Live Drummer <span class="swing-value">52%</span></h3>
                <p>Extracted from a real drum recording. Natural variation and organic timing shifts.</p>
                <div class="groove-visual">
                  <div class="groove-dot" style="margin-left: 2px;"></div>
                  <div class="groove-dot" style="margin-left: 5px;"></div>
                  <div class="groove-dot" style="margin-left: -2px;"></div>
                  <div class="groove-dot" style="margin-left: 3px;"></div>
                </div>
              </div>
            </div>
          </article>

          <article class="section">
            <div class="section-eyebrow">Parameters</div>
            <h2 class="section-title">Humanization Controls</h2>
            <p class="section-body">
              Most DAWs provide controls to randomize timing and velocity. Here's what each parameter does:
            </p>

            <div class="humanize-controls">
              <div class="control-group">
                <label>Timing Randomization (ms)</label>
                <div class="slider-container">
                  <input type="range" min="0" max="30" value="10" id="timingSlider">
                  <span class="slider-value" id="timingValue">10ms</span>
                </div>
                <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: var(--space-xs);">
                  How much notes can shift from the grid. 5-15ms is subtle, 20+ feels loose.
                </p>
              </div>

              <div class="control-group">
                <label>Velocity Randomization (%)</label>
                <div class="slider-container">
                  <input type="range" min="0" max="40" value="15" id="velocitySlider">
                  <span class="slider-value" id="velocityValue">15%</span>
                </div>
                <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: var(--space-xs);">
                  How much velocity can vary. 10-20% adds life without losing punch.
                </p>
              </div>

              <div class="control-group">
                <label>Swing Amount (%)</label>
                <div class="slider-container">
                  <input type="range" min="50" max="75" value="54" id="swingSlider">
                  <span class="slider-value" id="swingValue">54%</span>
                </div>
                <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: var(--space-xs);">
                  50% = straight, 67% = triplet feel. Hip-hop uses 54-58%, house uses 50-52%.
                </p>
              </div>
            </div>
          </article>
        </section>

        <!-- Exercise Instructions -->
        <section class="exercise-instructions" style="margin-top: var(--space-2xl);">
          <div class="exercise-box">
            <div class="section-eyebrow">Exercise</div>
            <h2 class="section-title">Humanize a Beat</h2>
            <p class="section-body">Apply humanization to make this robotic pattern feel alive.</p>

            <div class="exercise-steps">
              <h3>What to do:</h3>
              <ol class="exercise-checklist">
                <li>Start with the quantized pattern in the sequencer.</li>
                <li>Apply 10ms timing randomization to hi-hats only.</li>
                <li>Create a velocity curve: accents on beats, softer off-beats.</li>
                <li>Add 54% swing for MPC-style groove.</li>
              </ol>
            </div>

            <div class="exercise-tip">
              <strong>Listen carefully:</strong> Compare before and after. The humanized version should feel more "alive" and less robotic.
            </div>
          </div>
        </section>

        <!-- Full-Width Sequencer -->
        <section class="sequencer-section" style="margin-top: var(--space-xl);">
          <div class="section-eyebrow" style="margin-bottom: var(--space-sm);">Interactive Sequencer</div>
          <h2 class="section-title" style="margin-bottom: var(--space-lg);">16-Step Grid</h2>

          <div class="sequencer" id="mpl-sequencer-collection">
            <!-- Sequencer will be created by JS -->
          </div>

          <div style="display:flex;gap:0.75rem;margin-top:1.5rem;flex-wrap:wrap;align-items:center;">
            <button type="button" class="btn btn-outline" id="mpl-seq-play-all">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right:4px;"><polygon points="5 3 19 12 5 21 5 3"/></svg>
              Play
            </button>
            <button type="button" class="btn btn-outline" id="mpl-seq-stop-all">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right:4px;"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
              Stop
            </button>
            <button type="button" class="btn btn-primary" id="mpl-seq-check-all">
              Check Exercise
            </button>

            <div id="mpl-seq-next-lesson-wrap" style="margin-left:auto;">
              <button class="btn btn-primary" id="mpl-next-lesson" disabled title="Complete exercise to unlock">
                Next Lesson &rarr;
              </button>
            </div>
          </div>

          <div class="sequencer-status" id="mpl-seq-status" aria-live="polite" style="margin-top:1rem;">
            Complete the exercise to unlock the next lesson.
          </div>
        </section>

        <footer class="footer">
          <div>&copy; <span id="mpl-year"></span> Music Producer Lab · Lesson 13</div>
          <div><a class="footer-link" href="labs.html">Back to overview</a></div>
        </footer>
      </div>
    </div>

    <script>
      document.getElementById("mpl-year").textContent = new Date().getFullYear();

      // Slider interactivity
      document.querySelectorAll('input[type="range"]').forEach(slider => {
        const valueDisplay = document.getElementById(slider.id.replace('Slider', 'Value'));
        if (valueDisplay) {
          slider.addEventListener('input', () => {
            const unit = slider.id === 'timingSlider' ? 'ms' : '%';
            valueDisplay.textContent = slider.value + unit;
          });
        }
      });

      // Groove card selection
      document.querySelectorAll('.groove-card').forEach(card => {
        card.addEventListener('click', () => {
          document.querySelectorAll('.groove-card').forEach(c => c.classList.remove('active'));
          card.classList.add('active');
        });
      });
    </script>
    <script type="module">
      import { initDrumSequencer } from './sequencer.js';

      const LESSON_KEY = "mpl-drums-13-progress";
      const NEXT_LESSON_URL = "lesson-drums-14.html";

      const instruments = [
        {
          id: "kick",
          label: "Kick",
          color: "linear-gradient(135deg, #ff6b6b, #ee5a24)",
          target: [0, 4, 8, 12],
          instructions: "Basic kick pattern"
        },
        {
          id: "snare",
          label: "Snare",
          color: "linear-gradient(135deg, #feca57, #ff9f43)",
          target: [4, 12],
          instructions: "Snare on 2 and 4"
        },
        {
          id: "hihat",
          label: "Hi-Hat",
          color: "linear-gradient(135deg, #00d2d3, #01a3a4)",
          target: [0, 2, 4, 6, 8, 10, 12, 14],
          instructions: "8th note hi-hats"
        }
      ];

      initDrumSequencer(instruments, LESSON_KEY, NEXT_LESSON_URL);
    </script>
  </body>
</html>
