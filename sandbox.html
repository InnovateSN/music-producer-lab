<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Drum Sandbox Â· Music Producer Lab</title>
    <meta name="viewport" content="width=1200, initial-scale=1.0, viewport-fit=cover" />
    <meta name="description" content="Free drum pattern sandbox - experiment with beats, rhythms, and fills without any restrictions." />
    <meta name="theme-color" content="#030508">
    <link rel="icon" type="image/svg+xml" href="mpl-favicon.svg">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <div class="page">
      <div class="page-inner">
        <!-- HEADER NAV -->
        <header class="mpl-nav" id="mpl-header">
          <div class="mpl-nav-logo">
            <img src="mpl-logo-full.svg" alt="Music Producer Lab" class="mpl-nav-logo-img" />
          </div>
          <div class="mpl-nav-actions">
            <button class="btn btn-outline" type="button" onclick="window.location.href='labs.html'">
              <span>Back to Labs</span>
            </button>
          </div>
        </header>

        <!-- HERO SECTION -->
        <section class="hero" aria-label="Sandbox mode">
          <div class="hero-copy">
            <div class="hero-copy-eyebrow">Sandbox Mode</div>
            <h1 class="hero-title">
              Drum Pattern <span>Playground</span>.
            </h1>
            <p class="hero-subtitle">
              No rules, no targets - just create! Experiment freely with different drum patterns, 
              adjust tempo and swing, save your favorite presets.
            </p>
          </div>
        </section>

        <!-- SEQUENCER SECTION -->
        <section class="sequencer-section" style="margin-top: var(--space-xl);">
          <div class="section-eyebrow" style="margin-bottom: var(--space-sm);">Interactive Sequencer</div>
          <h2 class="section-title" style="margin-bottom: var(--space-lg);"><span id="mpl-step-count-label">16</span>-Step Grid</h2>
          
          <div class="sequencer" id="mpl-sequencer-collection">
            <!-- Sequencer will be created by JS -->
          </div>

          <!-- CONTROLS -->
          <div class="sequencer-controls" style="display:flex;gap:0.75rem;margin-top:1.5rem;flex-wrap:wrap;align-items:center;">
            <button type="button" class="btn btn-outline" id="mpl-seq-play-all">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right:4px;"><polygon points="5 3 19 12 5 21 5 3"/></svg>
              Play
            </button>
            <button type="button" class="btn btn-outline" id="mpl-seq-stop-all">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right:4px;"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
              Stop
            </button>
            <button type="button" class="btn btn-outline" id="mpl-seq-clear-all">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:4px;"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
              Clear
            </button>
            
            <!-- PRESET CONTROLS -->
            <div style="display:flex;gap:0.5rem;margin-left:0.5rem;">
              <button type="button" class="btn btn-outline btn-sm" id="mpl-preset-save">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:4px;"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17,21 17,13 7,13 7,21"/><polyline points="7,3 7,8 15,8"/></svg>
                Save
              </button>
              <button type="button" class="btn btn-outline btn-sm" id="mpl-preset-load">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:4px;"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                Load
              </button>
              <button type="button" class="btn btn-outline btn-sm" id="mpl-export-json">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:4px;"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/></svg>
                Export
              </button>
            </div>
          </div>

          <!-- TEMPO/SWING CONTROLS -->
          <div id="mpl-advanced-controls" style="display:flex;margin-top:1rem;padding:1rem;background:var(--bg-secondary);border-radius:var(--radius-md);gap:1.5rem;flex-wrap:wrap;align-items:center;">
            <div style="display:flex;align-items:center;gap:0.5rem;">
              <label for="mpl-tempo-slider" style="font-size:0.85rem;color:var(--text-muted);">Tempo:</label>
              <input type="range" id="mpl-tempo-slider" min="60" max="180" value="120" style="width:120px;">
              <span id="mpl-tempo-value" style="font-family:var(--font-mono);font-size:0.85rem;min-width:60px;">120 BPM</span>
            </div>
            <div style="display:flex;align-items:center;gap:0.5rem;">
              <label for="mpl-swing-slider" style="font-size:0.85rem;color:var(--text-muted);">Swing:</label>
              <input type="range" id="mpl-swing-slider" min="0" max="100" value="0" style="width:120px;">
              <span id="mpl-swing-value" style="font-family:var(--font-mono);font-size:0.85rem;min-width:40px;">0%</span>
            </div>
            <div style="display:flex;align-items:center;gap:0.5rem;">
              <label for="mpl-steps-select" style="font-size:0.85rem;color:var(--text-muted);">Steps:</label>
              <select id="mpl-steps-select" class="form-select" style="min-height:36px;padding:0.5rem;width:auto;">
                <option value="8">8 steps</option>
                <option value="16" selected>16 steps</option>
                <option value="32">32 steps</option>
              </select>
            </div>
          </div>

          <div class="sequencer-status" id="mpl-seq-status" aria-live="polite" style="margin-top:1rem;">
            Sandbox mode - experiment freely with the sequencer!
          </div>
        </section>

        <!-- TIPS SECTION -->
        <section class="exercise-instructions" style="margin-top: var(--space-2xl);">
          <div class="exercise-box">
            <div class="section-eyebrow">Tips</div>
            <h2 class="section-title">Ideas to Get Started</h2>
            <div class="exercise-steps">
              <h3>Try these patterns:</h3>
              <ol class="exercise-checklist">
                <li><strong>4 on the floor:</strong> Kick on steps 1, 5, 9, 13 - the foundation of house and techno.</li>
                <li><strong>Basic backbeat:</strong> Snare on steps 5 and 13 - the backbone of rock and pop.</li>
                <li><strong>Straight 8ths:</strong> Hi-hat on every odd step (1, 3, 5, 7...) - classic driving rhythm.</li>
                <li><strong>Add swing:</strong> Move the slider to 30-50% for a more groovy, human feel.</li>
                <li><strong>Create fills:</strong> Break the pattern in beat 4 with extra hits to signal transitions.</li>
              </ol>
            </div>
            <div class="exercise-tip">
              <strong>Pro tip:</strong> Use the Save button to store patterns you like, then Load them later to continue experimenting!
            </div>
          </div>
        </section>

        <!-- FOOTER -->
        <footer class="footer" id="mpl-footer">
          <div>&copy; <span id="mpl-year"></span> Music Producer Lab</div>
          <div><a class="footer-link" href="labs.html">Back to Labs</a></div>
        </footer>
      </div>
      
      <script>document.getElementById("mpl-year").textContent = new Date().getFullYear();</script>
      
      <script type="module">
        import { initDrumSequencer } from './sequencer.js';

        // Sandbox mode instruments (all common drum sounds)
        const instruments = [
          {
            id: "kick",
            label: "Kick",
            color: "linear-gradient(135deg,#ff5a3d,#ffb28a)",
            target: [], // No target in sandbox
            instructions: ""
          },
          {
            id: "snare",
            label: "Snare",
            color: "linear-gradient(135deg,#5f4dff,#8a9bff)",
            target: [],
            instructions: ""
          },
          {
            id: "hihat",
            label: "Hi-Hat",
            color: "linear-gradient(135deg,#00d4ff,#b8ffdd)",
            target: [],
            instructions: ""
          },
          {
            id: "clap",
            label: "Clap",
            color: "linear-gradient(135deg,#ff66b2,#ffb8dd)",
            target: [],
            instructions: ""
          },
          {
            id: "tom",
            label: "Tom",
            color: "linear-gradient(135deg,#ffcc00,#ffee99)",
            target: [],
            instructions: ""
          }
        ];

        let currentStepCount = 16;
        let currentTempo = 120;
        let currentSwing = 0;

        // Initialize sequencer
        function initSandbox() {
          initDrumSequencer(
            instruments,
            "mpl-sandbox-pattern",
            null, // No next lesson in sandbox
            {
              tempo: currentTempo,
              stepCount: currentStepCount,
              swing: currentSwing,
              sandbox: true,
              autoSave: true,
              enableVelocity: true,
              enableHumanization: true
            }
          );
          
          // Update step count label
          document.getElementById('mpl-step-count-label').textContent = currentStepCount;
        }

        initSandbox();

        // Tempo slider
        const tempoSlider = document.getElementById('mpl-tempo-slider');
        const tempoValue = document.getElementById('mpl-tempo-value');
        tempoSlider.addEventListener('input', () => {
          currentTempo = parseInt(tempoSlider.value);
          tempoValue.textContent = `${currentTempo} BPM`;
          window.dispatchEvent(new CustomEvent('mpl-tempo-change', { detail: { tempo: currentTempo } }));
        });

        // Swing slider
        const swingSlider = document.getElementById('mpl-swing-slider');
        const swingValue = document.getElementById('mpl-swing-value');
        swingSlider.addEventListener('input', () => {
          currentSwing = parseInt(swingSlider.value);
          swingValue.textContent = `${currentSwing}%`;
          window.dispatchEvent(new CustomEvent('mpl-swing-change', { detail: { swing: currentSwing } }));
        });

        // Step count selector
        const stepsSelect = document.getElementById('mpl-steps-select');
        stepsSelect.addEventListener('change', () => {
          currentStepCount = parseInt(stepsSelect.value);
          // Re-initialize sequencer with new step count
          initSandbox();
        });

        // Preset Save
        document.getElementById('mpl-preset-save').addEventListener('click', () => {
          window.dispatchEvent(new CustomEvent('mpl-preset-save'));
        });

        // Preset Load
        document.getElementById('mpl-preset-load').addEventListener('click', () => {
          window.dispatchEvent(new CustomEvent('mpl-preset-load'));
        });

        // Export JSON
        document.getElementById('mpl-export-json').addEventListener('click', () => {
          try {
            const pattern = localStorage.getItem('mpl-sandbox-pattern-pattern');
            if (pattern) {
              const exportData = {
                name: 'Sandbox Pattern',
                tempo: currentTempo,
                swing: currentSwing,
                stepCount: currentStepCount,
                pattern: JSON.parse(pattern),
                exportedAt: new Date().toISOString()
              };
              
              const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `mpl-pattern-${Date.now()}.json`;
              a.click();
              URL.revokeObjectURL(url);
            } else {
              alert('No pattern to export! Create some beats first.');
            }
          } catch (e) {
            console.error('Export failed:', e);
            alert('Export failed. Please try again.');
          }
        });

        // Clear button
        document.getElementById('mpl-seq-clear-all').addEventListener('click', () => {
          // Clear localStorage pattern
          localStorage.removeItem('mpl-sandbox-pattern-pattern');
          // Re-initialize to reset UI
          initSandbox();
        });
      </script>
    </div>
  </body>
</html>
